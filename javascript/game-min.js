!function(){var e={shortSword:{name:"Short Sword",carryWeight:3,damage:5,materials:[{iron:2,wood:1}]},basicSword:{name:"Basic Sword",carryWeight:5,damage:8,materials:[{iron:3,bronze:1,wood:1}]},megaSword:{name:"Mega Sword",carryWeight:9,damage:12,materials:[{iron:4,gold:2,wood:1}]},basicAxe:{name:"Basic Axe",carryWeight:5,damage:3,materials:[{iron:2,wood:1}]},solidAxe:{name:"Solid Axe",carryWeight:8,damage:6,materials:[{iron:3,bronze:1,wood:1}]},electrum:{name:"Electrum",carryWeight:2,materials:[{gold:1,silver:1}]},bronze:{name:"Bronze Bar",carryWeight:2,materials:[{copper:3,tin:1}]},iron:{name:"Iron Bar",carryWeight:2,envType:"mine",probabilityRatio:4},copper:{name:"Copper Bar",carryWeight:2,envType:"mine",probabilityRatio:4},tin:{name:"Tin Bar",carryWeight:2,envType:"mine",probabilityRatio:4},gold:{name:"Gold Bar",carryWeight:2,envType:"mine",probabilityRatio:2},silver:{name:"Silver Bar",carryWeight:2,envType:"mine",probabilityRatio:1},wood:{name:"Wood",carryWeight:1,envType:"forest",probabilityRatio:1}},t={maxCarryWeight:100,currentCarryWeight:0,current:[],giveItem:function(n,r=1){if(!e[n])return!1;return t.currentCarryWeight+e[n].carryWeight*r>t.maxCarryWeight?(c("Cannot carry any more Items!","red"),!1):(this.hasItem(n)?this.current[n].count+=r:this.current[n]={count:r},t.currentCarryWeight+=e[n].carryWeight*r,!0)},getNeeded:function(e,n=1){let r=t.getItemCount(e);return 0==r?n:r>=n?0:n-r},getItemCount:function(e){return void 0===t.current[e]||0===t.current[e].count?0:t.current[e].count},removeItem:function(n,r=1){if(!this.hasItem(n))return!1;this.current[n].count>r?this.current[n].count-=r:delete this.current[n],t.currentCarryWeight-=e[n].carryWeight*r},hasItem:function(e,t=1){return void 0!==this.current[e]&&this.current[e].count>=t}},n={paused:!1,startPosition:{x:0,y:0},environment:{},bear:{display:!0,position:{x:0,y:0}},player:{xp:0,level:1,display:!0,dead:!1,position:{x:0,y:0}},levelScale:.04,init:function(){n.createTable(),n.setListeners(),n.generateEnvironment(),n.startPosition=n.player.position,n.displayGame()},deleteGameImages:function(){var e=document.querySelectorAll(".game-table td > img");[].forEach.call(e,function(e){e.parentNode.removeChild(e)})},deleteSpentProgressBars(){var e=document.querySelectorAll('.progress-bars .percentage[data-spent="1"]');[].forEach.call(e,function(e){e.parentNode.removeChild(e)})},displayGame:function(){for(var e in n.deleteGameImages(),n.deleteSpentProgressBars(),n.displayAt(n.player.position,"icons/player.png",10),n.bear.display&&n.displayAt(n.bear.position,"icons/bear.png",10),n.environment)n.displayAt(n.environment[e].position,"icons/"+n.environment[e].envType+".png",n.environment[e].zIndex);n.displayArrows(),n.locationChecks();var r="0%";let i=t.currentCarryWeight,a=t.maxCarryWeight;0!==i&&(r=Math.floor(i/a*100)+"%"),document.querySelector("#btn-carry").innerHTML="Carry: "+r},craftItem:function(r,i=1){if(!e[r])return!1;if(!e[r].materials)return t.giveItem(r,i),!1;c("Crafting "+i+" "+e[r].name);const a=e[r].materials[0];var o=!1;for(var l in a){let n=a[l]*i;t.hasItem(l,n)||(!1===o&&c("You do not have the required items to craft a "+e[r].name,"red"),o=t.getNeeded(l,n),c(">> "+e[l].name+": You need "+o+" more"))}if(!1!==o)return!1;for(var s in a)t.removeItem(s,a[s]*i);return t.giveItem(r,i),n.displayGame(),!0},giveXP:function(e){n.player.xp+=e,n.player.level=Math.ceil(n.levelScale*Math.sqrt(n.player.xp)),document.querySelector("#btn-xp").innerHTML="XP: "+n.player.xp,document.querySelector("#btn-level").innerHTML="Level: "+n.player.level},locationChecks:function(){n.withinXBlocks(n.bear.position,n.player.position,2)?document.querySelector(".game-table").classList.add("bear-close"):document.querySelector(".game-table").classList.remove("bear-close")},toggleBearVisibility:function(){n.bear.display=!n.bear.display,n.displayGame()},togglePlayerVisibility:function(){n.player.display=!n.player.display,n.displayGame()},displayArrows:function(){var e=n.getDirectionCoords(n.player.position);for(var t in e)if(n.validPosition(e[t])){var r=n.displayAt(e[t],"icons/"+t+".png");r.setAttribute("class","directionBtn"),r.setAttribute("data-pos",JSON.stringify(e[t])),r.addEventListener("click",function(){n.movePlayer(JSON.parse(this.getAttribute("data-pos")))})}},movePlayer:function(e,t=!0){return!(!n.validPosition(e)||!1!==n.paused)&&(n.player.position=e,n.checkCollision()?(alert("You have died."),n.exit(),!1):(t&&n.moveBear(),n.checkCollision()?(alert("You have died."),n.exit(),!1):void 0))},checkCollision:function(e=!1,t=!1){return e&&t||(e=n.player.position,t=n.bear.position),e.x==t.x&&e.y==t.y},moveBear:function(e=!1){if(e)n.bear.position=e;else{var t=n.moveRandDirection(n.bear.position);n.validPosition(t)?n.checkCollision(t,n.player.position)&&n.ranNum(0,100)>50?n.moveBear():n.bear.position=t:n.moveBear()}n.displayGame()},validPosition:function(e=!1){return null!=e&&0!=e&&(e.x>=0&&e.x<=9&&e.y>=0&&e.y<=9)},moveRandDirection:function(e){var t=Object.assign({},e),r=n.getDirectionCoords(t),i=n;for(var a in r)i.validPosition(r[a])||delete r[a];return r.length<1?(n.exit(),!1):r[{1:"north",2:"east",3:"south",4:"west"}[n.ranNum(1,4)]]},displayAt:function(e,t,r=0){if(e){var i=n.getCell({x:e.x,y:e.y});if(i){var a=new Image(45,45);return a.src=t,r>0&&(a.style.zIndex=r),i.appendChild(a),a}}},getCell:function(e){return document.querySelector("tr[data-row='"+e.y+"'] > .cell[data-col='"+e.x+"']")},generateEnvironment:function(){n.player.position=n.getRandomLocation(),n.bear.position=n.getRandomLocation(3),n.addEnvironmentElement("cabin",n.startPosition);for(var e=0;e<8;e++)n.addElementRandomLocation("mountain"),n.addElementRandomLocation("forest");for(var t=0;t<3;t++)n.addElementRandomLocation("cave"),n.addElementRandomLocation("mine");n.addElementRandomLocation("river")},addElementRandomLocation:function(e,t=0){0==n.addEnvironmentElement(e,n.getRandomLocation(),t)&&n.addElementRandomLocation(e,t)},addEnvironmentElement:function(e,t,r=0){var i=Object.keys(this.environment).length+1;return Object.keys(n.environment).forEach(function(e){if(n.environment[e].position.x==t.x&&n.environment[e].position.y==t.y)return!1}),n.environment[i]={envType:e,position:t,zIndex:r},!0},getRandomLocation:function(e=!1){var t={x:n.ranNum(0,9),y:n.ranNum(0,9)};return!1!==n.getExistingEnvironment(t)?n.getRandomLocation(e):!1===e?t:n.withinXBlocks(t,n.player.position,e)?n.getRandomLocation(e):t},withinXBlocks:function(e,t,n=3){return Math.abs(e.x-t.x)<=n&&Math.abs(e.y-t.y)<=n},setListeners:function(){document.addEventListener("keydown",n.handleKeyboardEvent,!1)},handleEnvInteraction:function(){var e=n.getExistingEnvironment(n.player.position);if(!1!==e)switch(n.environment[e].envType){case"mine":n.interactWithMine(e);break;case"forest":n.interactWithForest(e)}},getExistingEnvironment:function(e){var t=Object.assign({},e);for(var r in n.environment){var i=n.environment[r].position;if(i.x===t.x&&i.y===t.y)return r}return!1},interactWithMine:function(e){c("Mining...","yellow"),n.genericEnvInteract(e)},cbguard:function(e){var t=e;return function(){if(t){var e=t;return t=!1,e.apply(this,arguments)}}},genericEnvInteract:function(r){var i=[];for(var a in e)if(e[a].envType===n.environment[r].envType)for(var o=0;o<=e[a].probabilityRatio;o++)i.push(a);var l=n.ranNum(0,i.length-1),s=n.ranNum(1,2);n.progressBar(3e3,function(){t.giveItem(i[l],s)&&c("Gained +"+s+" "+e[i[l]].name,"green"),n.displayGame()},!0)},progressBar:function(e,t,i=!0){!0===i&&(n.paused=!0);var a=n.cbguard(t),o=document.querySelector(".progress-bars"),c=r("percentage");o.appendChild(c);var l=window.performance.now();window.requestAnimationFrame(function t(r){c.setAttribute("data-spent",0);var o=Math.round(r-l),s=Math.round(o/e*100);s=s>100?100:s,c.style.width=s+"%",o<e&&window.requestAnimationFrame(t),100==s&&(!0===i&&(n.paused=!1),c.style.width="0%",c.setAttribute("data-spent",1),a(!0))})},interactWithForest:function(e){c("Chopping Trees...","yellow"),n.genericEnvInteract(e)},handleKeyboardEvent:function(e){if(!n.player.dead&&!n.paused){var t=n.getDirectionCoords(n.player.position);switch(e||(e=window.event),e.keyCode||e.which){case 13:n.handleEnvInteraction();break;case 37:n.movePlayer(t.west);break;case 38:n.movePlayer(t.north);break;case 39:n.movePlayer(t.east);break;case 40:n.movePlayer(t.south)}}},getDirectionCoords:function(e){var t=Object.assign({},e);return{west:{x:t.x-1,y:t.y},east:{x:t.x+1,y:t.y},north:{x:t.x,y:t.y-1},south:{x:t.x,y:t.y+1}}},createTable:function(){var e=document.querySelector("#game-container").appendChild(document.createElement("table"));e.setAttribute("class","game-table"),e.setAttribute("data-table","main"),e.setAttribute("cellpadding","0"),e.setAttribute("cellspacing","0");for(var t=0,n=0;n<10;n++){var r=e.appendChild(document.createElement("tr"));r.setAttribute("data-row",n);for(var i=0;i<10;i++){t++;var a=r.appendChild(document.createElement("td"));a.setAttribute("data-cell",t),a.setAttribute("data-col",i),a.setAttribute("class","cell"),a.id="cell-"+t}}},ranNum:function(e=0,t=100){return Math.floor(Math.random()*(t-e+1)+e)},exit:function(){n.player.dead=!0,n.deleteGameImages()}};function r(e,t=!1,n="div"){var r=document.createElement(n);return r.setAttribute("class",e),!1!==t&&(r.innerText=t),r}function i(){var e=document.querySelectorAll(".popover, .popover-hide");[].forEach.call(e,function(e){e.classList.add("hidden")})}function a(e){i(),document.querySelector("#"+e+".popover").setAttribute("class","popover"),document.querySelector(".popover-hide").setAttribute("class","popover-hide")}function o(e,t){var n=document.createElement("img");return n.src="icons/"+e+".png",n.setAttribute("class","item-image"),n.setAttribute("width",t),n.setAttribute("height",t),n}function c(e,t="white"){var n=document.querySelector(".visible-log"),i=r("entry",e);t&&(i.style.color=t),n.appendChild(i),n.scrollTop=n.scrollHeight}document.querySelector("#btn-inventory").addEventListener("click",function(){!function n(){var i=document.querySelector("#inventory .popover-content");var c=document.querySelectorAll("#inventory .item");[].forEach.call(c,function(e){e.parentNode.removeChild(e)});for(var l in t.current){var s=r("item"),d=r("item-name",e[l].name),u=o(l,120),m=r("item-count",t.current[l].count),p=r("item-remove","Delete Item");p.setAttribute("data-key",l),s.appendChildren([m,d,u,p]),i.appendChild(s),p.addEventListener("click",function(){t.removeItem(this.getAttribute("data-key")),n()})}a("inventory")}()}),document.querySelector("#btn-crafting").addEventListener("click",function(){!function i(){var c=document.querySelector("#crafting .popover-content");var l=document.querySelectorAll("#crafting .item");[].forEach.call(l,function(e){e.parentNode.removeChild(e)});for(var s in e)if(void 0!==e[s].materials){var d=e[s].name,u=e[s].materials[0],m=r("item"),p=r("item-name",d,"div"),v=r("items-required"),y=o(s,64),h=!0;for(var g in u){var f=r("req-item"),b=r("req-item-name",e[g].name),E=r("req-item-count",u[g]),x=o(g,24);!0===t.hasItem(g,u[g])?E.classList.add("over"):(E.classList.add("under"),h=!1),f.appendChildren([x,b,E]),v.appendChild(f)}var C=r("item-craft","Craft");C.setAttribute("data-item",s),h?C.addEventListener("click",function(){n.craftItem(this.getAttribute("data-item")),i()}):C.classList.add("disabled"),m.appendChildren([p,y,v,C]),c.appendChild(m)}a("crafting")}()}),document.querySelector("#btn-hints").addEventListener("click",function(){a("hints")}),document.querySelector("#btn-help").addEventListener("click",function(){a("help")}),document.querySelector(".popover-hide").addEventListener("click",function(){i()}),HTMLDivElement.prototype.appendChildren=function(e){for(var t in e)this.appendChild(e[t])},n.init(),n.giveXP(1)}();